import{s as e,j as s,u as a}from"./index-DA5iXhq6.js";import{r as t,L as n,u as r}from"./react-vendor-DrMYZYBk.js";import{V as l,B as i,a as c,v as o,X as d,w as h}from"./ui-vendor-CRI_hzdD.js";function m(){const[a,r]=t.useState(!1),[c,o]=t.useState([]),[d,h]=t.useState(!0),m=t.useRef(null);async function x(){try{h(!0);const{data:{user:s}}=await e.auth.getUser();if(!s)return void o([]);const{data:a,error:t}=await e.from("friendships").select("\n          id,\n          user_id,\n          created_at,\n          user:profiles!friendships_user_id_fkey (\n            username,\n            full_name,\n            avatar_url\n          )\n        ").eq("friend_id",s.id).eq("status","pending");if(t)throw t;o(a||[])}catch(s){l.error("Fehler beim Laden der Benachrichtigungen")}finally{h(!1)}}async function u(s,a){try{const{error:t}=await e.from("friendships").update({status:a?"accepted":"declined"}).eq("id",s);if(t)throw t;o(c.filter((e=>e.id!==s))),l.success(a?"Freundschaftsanfrage angenommen":"Freundschaftsanfrage abgelehnt")}catch(t){l.error("Fehler beim Bearbeiten der Anfrage")}}return t.useEffect((()=>{x();const s=e.channel("friend-requests").on("postgres_changes",{event:"*",schema:"public",table:"friendships"},(()=>{x()})).subscribe();return()=>{e.removeChannel(s)}}),[]),t.useEffect((()=>{function e(e){m.current&&!m.current.contains(e.target)&&r(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]),s.jsxs("div",{ref:m,className:"relative",children:[s.jsxs("button",{onClick:()=>r(!a),className:"relative p-2 hover:bg-gray-100 rounded-full",children:[s.jsx(i,{className:"w-5 h-5"}),c.length>0&&s.jsx("span",{className:"absolute top-0 right-0 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:c.length})]}),a&&s.jsx("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg z-50",children:s.jsxs("div",{className:"p-4",children:[s.jsx("h3",{className:"font-bold mb-4",children:"Benachrichtigungen"}),d?s.jsx("p",{className:"text-gray-500 text-center py-4",children:"Lädt..."}):0===c.length?s.jsx("p",{className:"text-gray-500 text-center py-4",children:"Keine neuen Benachrichtigungen"}):s.jsx("div",{className:"space-y-4",children:c.map((e=>s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(n,{to:`/profile/${e.user.username}`,className:"flex-shrink-0",onClick:()=>r(!1),children:e.user.avatar_url?s.jsx("img",{src:e.user.avatar_url,alt:e.user.username,className:"w-10 h-10 rounded-full object-cover"}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx(n,{to:`/profile/${e.user.username}`,className:"font-medium hover:underline",onClick:()=>r(!1),children:e.user.full_name||e.user.username}),s.jsx("p",{className:"text-sm text-gray-500",children:"möchte dich als Freund:in hinzufügen"}),s.jsxs("div",{className:"flex gap-2 mt-2",children:[s.jsx("button",{onClick:()=>u(e.id,!0),className:"px-3 py-1 bg-black text-white text-sm rounded-full hover:bg-gray-900",children:"Annehmen"}),s.jsx("button",{onClick:()=>u(e.id,!1),className:"px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full hover:bg-gray-200",children:"Ablehnen"})]})]})]},e.id)))})]})})]})}function x({onLogout:e,onLoginClick:l,onSignUpClick:i}){const{session:x}=a(),u=r(),[f,g]=t.useState(!1),p=[{path:"/",label:"Home"},{path:"/about",label:"Über Uns"}],b=e=>"/"===e?"/"===u.pathname:u.pathname.startsWith(e);return s.jsx("nav",{className:"fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-50",children:s.jsxs("div",{className:"w-full max-w-screen-2xl mx-auto h-full px-4 sm:px-8 flex items-center justify-between",children:[s.jsx(n,{to:"/",className:"flex-shrink-0",children:s.jsx("img",{src:"https://iqqjvjzvzizrxbymrjoc.supabase.co/storage/v1/object/public/peakly/logo/Peakly%20Logo.png",alt:"Peakly",className:"h-8 w-auto"})}),s.jsxs("div",{className:"hidden md:flex items-center gap-8",children:[p.map((({path:e,label:a})=>s.jsx(n,{to:e,className:"font-safiro hover:text-gray-600 "+(b(e)?"text-black font-semibold":"text-gray-500"),children:a},e))),x?s.jsxs(s.Fragment,{children:[s.jsxs(n,{to:"/profile",className:"flex items-center gap-2 font-safiro "+(b("/profile")?"text-black font-semibold":"text-gray-500"),children:[s.jsx(c,{className:"w-5 h-5"}),"Mein Profil"]}),s.jsx(m,{}),s.jsxs("button",{onClick:e,className:"flex items-center gap-2 text-gray-500 hover:text-gray-600 font-safiro",children:[s.jsx(o,{className:"w-5 h-5"}),s.jsx("span",{className:"hidden sm:inline",children:"Abmelden"})]})]}):s.jsxs("div",{className:"flex gap-4",children:[s.jsx("button",{onClick:l,className:"text-black px-6 py-3 hover:underline font-safiro",children:"Anmelden"}),s.jsx("button",{onClick:i,className:"bg-black text-white px-6 py-3 rounded-xl hover:bg-gray-900 transition-colors font-safiro",children:"Profil erstellen"})]})]}),s.jsxs("div",{className:"md:hidden flex items-center gap-2",children:[x&&s.jsx(m,{}),s.jsx("button",{onClick:()=>g(!f),className:"p-2 hover:bg-gray-100 rounded-full",children:f?s.jsx(d,{className:"w-6 h-6"}):s.jsx(h,{className:"w-6 h-6"})})]}),f&&s.jsx("div",{className:"absolute top-16 left-0 right-0 bg-white border-b border-gray-200 shadow-lg md:hidden",children:s.jsxs("div",{className:"flex flex-col p-4",children:[p.map((({path:e,label:a})=>s.jsx(n,{to:e,className:"py-3 px-4 font-safiro "+(b(e)?"text-black font-semibold":"text-gray-500"),onClick:()=>g(!1),children:a},e))),x?s.jsxs(s.Fragment,{children:[s.jsxs(n,{to:"/profile",className:"py-3 px-4 flex items-center gap-2 font-safiro "+(b("/profile")?"text-black font-semibold":"text-gray-500"),onClick:()=>g(!1),children:[s.jsx(c,{className:"w-5 h-5"}),"Mein Profil"]}),s.jsxs("button",{onClick:()=>{e?.(),g(!1)},className:"py-3 px-4 flex items-center gap-2 text-gray-500 font-safiro",children:[s.jsx(o,{className:"w-5 h-5"}),"Abmelden"]})]}):s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsx("button",{onClick:()=>{l?.(),g(!1)},className:"block w-full py-3 text-center text-black hover:bg-gray-50 font-safiro rounded-xl",children:"Anmelden"}),s.jsx("button",{onClick:()=>{i?.(),g(!1)},className:"block w-full py-3 text-center bg-black text-white hover:bg-gray-900 font-safiro rounded-xl",children:"Profil erstellen"})]})]})})]})})}export{x as N};
