import{u as e,s,j as t}from"./index-DA5iXhq6.js";import{i as a,h as r,r as i}from"./react-vendor-DrMYZYBk.js";import{N as l}from"./Navbar-DOM3g2ZX.js";import{S as n}from"./ShareModal-Dvz0fxPp.js";import{V as o,t as c,m as d,r as p,C as u,j as m,b as x,p as h,P as g,g as f,X as j}from"./ui-vendor-CRI_hzdD.js";import{p as b}from"./format-B7_Hd8Ri.js";import"./supabase-2HotJipb.js";function y(){const{id:y}=a(),v=r(),{session:N}=e(),[w,_]=i.useState(!0),[k,C]=i.useState(null),[q,S]=i.useState(null),[A,W]=i.useState([]),[$,P]=i.useState(!1),[E,L]=i.useState(!1),[M,D]=i.useState(!1),[J,O]=i.useState(!1),[G,z]=i.useState("");i.useEffect((()=>{!async function(){try{if(_(!0),!y)return;const{data:e,error:t}=await s.from("peak_posts").select("*, user:profiles!peak_posts_user_id_fkey(*)").eq("id",y).single();if(t)throw t;if(!e)return o.error("Post not found"),void v("/");C(e),S(e.user);const{data:a,error:r}=await s.from("post_participants").select("*, user:profiles(*)").eq("post_id",y).eq("status","confirmed");if(r)throw r;const i=a.map((e=>({...e.user,status:e.status})));if(W(i),N?.user){const e=a.some((e=>e.user_id===N.user.id));P(e)}}catch(e){o.error("Error loading post details")}finally{_(!1)}}()}),[y]);if(w||!k||!q)return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx(l,{onLogout:async()=>{const{error:e}=await s.auth.signOut();e&&o.error("Error logging out"),v("/")}}),t.jsx("div",{className:"max-w-[1000px] mx-auto px-4 pt-20",children:t.jsx("div",{className:"text-center py-12",children:"Loading..."})})]});const B=N?.user?.id===k.user_id,I=A.filter((e=>"confirmed"===e.status)),R=k.max_participants?k.max_participants-I.length:null;return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx(l,{onLogout:async()=>{const{error:e}=await s.auth.signOut();e&&o.error("Error logging out"),v("/")}}),t.jsxs("div",{className:"max-w-[1000px] mx-auto px-4 pt-20",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("button",{onClick:()=>v("/"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[t.jsx(c,{className:"w-4 h-4"}),"Back to posts"]}),t.jsx("button",{onClick:()=>D(!0),className:"p-2 hover:bg-gray-100 rounded-full",children:t.jsx(d,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"bg-white rounded-xl shadow-sm",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-start mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold",children:k.title}),B&&t.jsx("button",{onClick:async()=>{if(k&&N?.user&&!E&&confirm("Are you sure you want to delete this post?"))try{L(!0);const{error:e}=await s.from("peak_posts").delete().eq("id",k.id).eq("user_id",N.user.id);if(e)throw e;o.success("Post deleted successfully"),v("/")}catch(e){o.error("Error deleting post")}finally{L(!1)}},disabled:E,className:"p-2 hover:bg-gray-100 rounded-full text-red-600",children:t.jsx(p,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"space-y-4 mb-8",children:[k.date&&t.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[t.jsx(u,{className:"w-5 h-5"}),t.jsx("span",{children:b(new Date(k.date),"dd.MM.yyyy")})]}),t.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[t.jsx(m,{className:"w-5 h-5"}),t.jsx("span",{children:k.location})]}),k.max_participants&&t.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[t.jsx(x,{className:"w-5 h-5"}),t.jsxs("span",{children:[R," ",1===R?"spot":"spots"," available (",I.length,"/",k.max_participants,")"]})]}),k.required_skill&&t.jsxs("div",{className:"inline-block px-3 py-1 bg-gray-100 rounded-full text-sm",children:[k.required_skill," ",k.required_level&&`â€¢ ${k.required_level}`]})]}),k.description&&t.jsxs("div",{className:"mb-8",children:[t.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Description"}),t.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:k.description})]}),t.jsx("div",{className:"mb-8",children:k.whatsapp_link?t.jsxs("a",{href:k.whatsapp_link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[t.jsx(h,{className:"w-5 h-5"}),"Join WhatsApp Group"]}):B&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("button",{onClick:()=>{if(!k)return;const e=`${k.title}\n\n${k.description||""}\n\nLocation: ${k.location}${k.date?`\nDate: ${b(new Date(k.date),"dd.MM.yyyy")}`:""}`,s=`https://wa.me/?text=${encodeURIComponent(`Join our climbing group!\n\n${e}\n\nCreate a WhatsApp group with this information and share the invite link back in the post.`)}`;window.open(s,"_blank")},className:"inline-flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[t.jsx(g,{className:"w-5 h-5"}),"Create WhatsApp Group"]}),J?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"url",value:G,onChange:e=>z(e.target.value),placeholder:"Paste WhatsApp group invite link",className:"flex-1 px-3 py-2 border rounded-lg text-sm"}),t.jsx("button",{onClick:async()=>{if(k)if(G.startsWith("https://chat.whatsapp.com/"))try{const{error:e}=await s.from("peak_posts").update({whatsapp_link:G}).eq("id",k.id);if(e)throw e;C((e=>e?{...e,whatsapp_link:G}:null)),O(!1),o.success("WhatsApp link added successfully")}catch(e){o.error("Error saving WhatsApp link")}else o.error("Please enter a valid WhatsApp group invite link")},className:"p-2 text-green-600 hover:bg-green-50 rounded-full",children:t.jsx(f,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>O(!1),className:"p-2 text-red-600 hover:bg-red-50 rounded-full",children:t.jsx(j,{className:"w-5 h-5"})})]}):t.jsx("button",{onClick:()=>O(!0),className:"block text-sm text-gray-500 hover:text-gray-700",children:"Add WhatsApp group link"})]})}),t.jsxs("div",{className:"border-t pt-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Participants"}),N?t.jsx("button",{onClick:async()=>{if(k&&N?.user)try{if($){const{error:e}=await s.from("post_participants").delete().eq("post_id",k.id).eq("user_id",N.user.id);if(e)throw e;W((e=>e.filter((e=>e.id!==N.user.id)))),P(!1),o.success("Left the post successfully")}else{const{data:e,error:t}=await s.from("post_participants").insert({post_id:k.id,user_id:N.user.id,status:"confirmed"}).select("*, user:profiles(*)").single();if(t)throw t;W((s=>[...s,{...e.user,status:"confirmed"}])),P(!0),o.success("Joined the post successfully")}}catch(e){o.error("Error updating participation")}else v("/login")},disabled:B||null!==R&&R<=0&&!$,className:`px-4 py-2 rounded-lg ${$?"bg-red-100 text-red-700 hover:bg-red-200":"bg-black text-white hover:bg-gray-900"} disabled:opacity-50 disabled:cursor-not-allowed`,children:$?"Leave Post":"Join Post"}):t.jsx("button",{onClick:()=>v("/login"),className:"px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-900",children:"Sign in to join"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-3",children:[q.avatar_url?t.jsx("img",{src:q.avatar_url,alt:q.username,className:"w-10 h-10 rounded-full object-cover"}):t.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:q.full_name||q.username}),t.jsx("div",{className:"text-sm text-gray-500",children:"Organizer"})]})]})}),A.map((e=>t.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-3",children:[e.avatar_url?t.jsx("img",{src:e.avatar_url,alt:e.username,className:"w-10 h-10 rounded-full object-cover"}):t.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),t.jsx("div",{className:"font-medium",children:e.full_name||e.username})]})},e.id))),0===A.length&&t.jsx("div",{className:"text-center text-gray-500 py-4",children:"No participants yet"})]})]})]})}),M&&t.jsx(n,{onClose:()=>D(!1)})]})]})}export{y as PeakPostDetail,y as default};
